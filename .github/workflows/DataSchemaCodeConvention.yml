name: Data Schema Code Convention Check

on:
  push:
  workflow_dispatch:

jobs:
  check_schema:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check SQL formatting rules
        run: |
          echo "Running SQL code convention check..."

          if [ ! -f DataSchema.sql ] && [ ! -f DataSchemaModified.sql ]; then
            echo "No SQL schema file found → FAIL"
            exit 1
          fi

          FILE="DataSchema.sql"
          if [ -f DataSchemaModified.sql ]; then
            FILE="DataSchemaModified.sql"
          fi

          echo "Checking SQL keywords..."

          if grep -Eiq "\b(select|from|where|and|or|insert|update|delete|create|table|primary|key)\b" DataSchema.sql; then
            echo "Found lowercase SQL keywords → FAIL"
            exit 1
          fi

          echo "SQL formatting OK"
