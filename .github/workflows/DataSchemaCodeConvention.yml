name: Data Schema Code Convention Check

on:
  push:
  workflow_dispatch:

jobs:
  check_schema:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install SQLFluff
        run: |
          pip install sqlfluff

      - name: Lint SQL schema
        run: |
          echo "Running SQLFluff..."
          
          if [ -f DataSchemaModified.sql ]; then
            FILE="DataSchemaModified.sql"
          elif [ -f DataSchema.sql ]; then
            FILE="DataSchema.sql"
          else
            echo "No SQL schema file found â†’ FAIL"
            exit 1
          fi

          sqlfluff lint "$FILE" --dialect postgres
